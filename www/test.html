<!doctype html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Holovideo Viewer</title>

<style>
	#container {
		background: #000;
		width: 400px;
		height: 300px;
	}
</style>

<script type="text/javascript" src="./glMatrix-0.9.5.min.js"></script>
<script type="text/javascript" src="./webgl-utils.js"></script>
<script type="text/javascript" src="./utils.js"></script>
<script type="text/javascript" src="./scene.js"></script>
<script type="text/javascript" src="./Libraries/threeJS/Three.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>

</head>

<body>
	<video id="holovideo" autoplay loop style="display:none">   
		<source src="./videos/test.mp4" type='video/mp4;'>
        Your browser doesn't appear to support the HTML5 <code>&lt;video&gt;</code> element. 
    </video>

	<div id="container">

	</div>
	
	<script type="text/javascript">

	function loadShader(url) 
	{
		var shaderSource = '';
		
		$.ajax(
		{
			url: url,
			dataType: 'text',
			success: function(results){shaderSource = results;},
			async:   false
		});
		
		return shaderSource;
	}
	
	var container;
	
	var camera, scene, renderer, composer;
	var holovideoFrame;
	
	var shaderColorConvert;
	
	// set the scene size
	var WIDTH = 600,
	    HEIGHT = 400;
	
	// set some camera attributes
	var VIEW_ANGLE = 45,
	    ASPECT = WIDTH / HEIGHT,
	    NEAR = 0.1,
	    FAR = 10000;
	
	init();
	animate();
	
	function initTextures()
	{
		var videoElement = $('#holovideo')[0];
		holovideoFrame = new THREE.Texture(videoElement);
		holovideoFrame.min_filter = THREE.LinearFilter;
		holovideoFrame.max_filter = THREE.LinearFilter;
		holovideoFrame.needsUpdate = true;
	}
	
	function initShaders()
	{
		uniforms = {
			image: {type: "t", 
					value: 0,
					texture: holovideoFrame						
					//texture: THREE.ImageUtils.loadTexture('./images/circleF6B4.png') 
					}
		};
		
		shaderColorConvert = new THREE.ShaderMaterial({
			uniforms: uniforms,
			vertexShader: loadShader('./shaders/colorChannelConvert.vert'),
			fragmentShader: loadShader('./shaders/colorChannelConvert.frag')
		});
	}
	
	function init()
	{
		// -----------------------------------------------------------------
		// Init renderer
		// -----------------------------------------------------------------
		$container = $('#container');
		renderer = new THREE.WebGLRenderer();
		$container.append(renderer.domElement);
		renderer.autoClear = false;

		// -----------------------------------------------------------------
		// Init textures and shaders
		// -----------------------------------------------------------------		
		initTextures();
		initShaders();
		
		// -----------------------------------------------------------------
		// Init camera and scene
		// -----------------------------------------------------------------	
		camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);
		camera.position.z = 4;
		
		scene = new THREE.Scene();
		var width = 2, height = 2, segmentsWidth = 2, segmentsHeight = 2;
		var mesh = new THREE.Mesh(
		   new THREE.PlaneGeometry(width, height, segmentsWidth, segmentsHeight),
		   shaderColorConvert
		);

		// add the mesh to the scene
		scene.add(mesh);
		scene.add(camera);
		
		// -----------------------------------------------------------------
		// Start the renderer
		// -----------------------------------------------------------------
		renderer.setSize(WIDTH, HEIGHT);
		renderer.setClearColorHex(0x000000, 1.0);		
	}
	
	function animate() 
	{
		requestAnimationFrame( animate );
	
		render();
	}	
	
	function render() 
	{
		holovideoFrame.needsUpdate = true;
		renderer.clear();
		renderer.render(scene, camera);
	}
</script>
	
</body></html>
